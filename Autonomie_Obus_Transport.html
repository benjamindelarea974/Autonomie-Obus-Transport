<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Autonomie bouteilles — O2 & Air</title>
  <style>
    :root{
      --bg: #0b1220;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --line: rgba(255,255,255,.14);
      --ok: #3ddc97;
      --stop: #ff5a7a;
      --ras: #ffd66e;
      --shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(78,179,255,.18), transparent 60%),
        radial-gradient(900px 500px at 85% 20%, rgba(255,125,200,.16), transparent 55%),
        radial-gradient(900px 700px at 45% 95%, rgba(61,220,151,.12), transparent 60%),
        var(--bg);
      min-height:100vh;
      padding: 28px 18px 40px;
    }
    .wrap{max-width:1050px; margin:0 auto;}
    header{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:16px; margin-bottom:18px;
    }
    h1{margin:0; font-size: clamp(22px, 3vw, 30px); letter-spacing:.2px}
    .subtitle{color:var(--muted); margin-top:6px; font-size:14px; line-height:1.35}
    .badge{
      padding:10px 12px; border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius: 14px;
      box-shadow: var(--shadow);
      color: var(--muted);
      font-size: 12px;
      max-width: 380px;
    }

    .grid{
      display:grid; gap:14px;
      grid-template-columns: 1.2fr .8fr;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns: 1fr;}
      header{flex-direction:column; align-items:flex-start;}
      .badge{max-width:100%;}
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:16px 16px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .card .hd h2{margin:0; font-size:16px}
    .card .hd p{margin:6px 0 0; color:var(--muted); font-size:13px}
    .card .bd{padding:16px}

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px 12px;
    }
    @media (max-width: 700px){
      .form{grid-template-columns: 1fr;}
    }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin: 0 0 6px;
    }
    .field{
      padding: 12px 12px 10px;
      background: var(--card2);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 14px;
    }
    .row{
      display:flex; gap:10px; align-items:center;
    }
    input, select{
      width: 100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      font-size: 14px;
    }
    input::placeholder{color: rgba(255,255,255,.35)}
    .unit{
      min-width:56px; text-align:right;
      color: var(--muted); font-size: 12px;
      padding-right:2px;
    }
    .hint{
      margin-top:8px;
      color: rgba(255,255,255,.55);
      font-size: 12px;
      line-height:1.35;
    }

    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 10px;
    }
    button{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-size: 13px;
    }
    button:hover{background: rgba(255,255,255,.12)}
    button.primary{
      background: rgba(61,220,151,.14);
      border-color: rgba(61,220,151,.35);
    }
    button.primary:hover{background: rgba(61,220,151,.20)}
    .note{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.45;
    }

    .results{
      display:grid; gap:12px;
    }
    .pill{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
    }
    .pill h3{margin:0; font-size:14px}
    .pill .meta{color: var(--muted); font-size:12px; margin-top:4px}
    .status{
      display:flex; flex-direction:column; align-items:flex-end; gap:6px;
      min-width: 140px;
    }
    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      font-weight: 700;
      letter-spacing:.2px;
      font-size: 12px;
      border: 1px solid transparent;
    }
    .chip.ok{color: rgba(0,0,0,.85); background: var(--ok); border-color: rgba(255,255,255,.15);}
    .chip.stop{color: white; background: rgba(255,90,122,.88); border-color: rgba(255,255,255,.15);}
    .chip.ras{color: rgba(0,0,0,.85); background: var(--ras); border-color: rgba(255,255,255,.15);}
    .value{
      color: var(--muted);
      font-size: 12px;
      text-align:right;
      line-height:1.25;
      white-space:nowrap;
    }

    .tiny{
      margin-top: 10px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,.18);
      color: rgba(255,255,255,.65);
      font-size: 12px;
      line-height: 1.45;
      background: rgba(255,255,255,.04);
    }
    .kpi{
      display:grid; gap:8px;
      grid-template-columns: 1fr 1fr;
      margin-top: 10px;
    }
    @media (max-width: 700px){
      .kpi{grid-template-columns:1fr;}
    }
    .kpi .box{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 12px 12px;
    }
    .kpi .t{color: var(--muted); font-size:12px}
    .kpi .n{font-size: 18px; font-weight:800; margin-top:4px}

.footer{
  max-width:1050px;
  margin: 18px auto 0;
  padding: 10px 14px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.05);
  color: rgba(255,255,255,.70);
  font-size: 12px;
  text-align: center;
}

  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Autonomie bouteilles — Oxygène & Air</h1>
        <div class="subtitle">
          Entrer ventilations et pressions, puis obtenir l’alerte <b>OK / STOP</b> selon un seuil de <b>45 min</b>.
        </div>
      </div>
      <div class="badge">
        Hypothèses (modifiable dans le code si besoin) : bouteille = <b>5 L</b>, marge O2 = <b>×1,3</b>,
        FiO2 exprimée en %, Vt en mL.
      </div>
    </header>

    <div class="grid">
      <!-- FORM -->
      <section class="card">
        <div class="hd">
          <h2>Formulaire</h2>
          <p>Respirateur + paramètres + pressions (O2 & Air)</p>
        </div>
        <div class="bd">
          <form id="frm" class="form" autocomplete="off">
            <div class="field">
              <label for="resp">Respirateur</label>
              <select id="resp" required>
                <option value="Fabian">Fabian</option>
                <option value="BabyPAC">BabyPAC</option>
                <option value="Oxylog 2000">Oxylog 2000</option>
              </select>
              <div class="hint">Air : débit fixe (Fabian 20 L/min, BabyPAC 10 L/min). Oxylog 2000 : Air = RAS.</div>
            </div>

            <div class="field">
              <label for="pO2">Pression bouteille O2</label>
              <div class="row">
                <input id="pO2" type="text" inputmode="decimal" placeholder="ex: 200" />
                <div class="unit">bar</div>
              </div>
              <div class="hint">Ex : 200 (sans “bar” idéalement). Accepte aussi “200 bar”.</div>
            </div>

            <div class="field">
              <label for="pAir">Pression bouteille Air</label>
              <div class="row">
                <input id="pAir" type="text" inputmode="decimal" placeholder="ex: 200" />
                <div class="unit">bar</div>
              </div>
              <div class="hint">Pour l’autonomie Air. Oxylog 2000 → RAS (hors règle).</div>
            </div>

            <div class="field">
              <label for="fr">FR</label>
              <div class="row">
                <input id="fr" type="number" min="0" step="1" placeholder="ex: 30" />
                <div class="unit">/min</div>
              </div>
              <div class="hint">Fréquence respiratoire.</div>
            </div>

            <div class="field">
              <label for="vt">Vt</label>
              <div class="row">
                <input id="vt" type="number" min="0" step="1" placeholder="ex: 120" />
                <div class="unit">mL</div>
              </div>
              <div class="hint">Volume courant en mL.</div>
            </div>

            <div class="field">
              <label for="fio2">FiO2</label>
              <div class="row">
                <input id="fio2" type="number" min="21" max="100" step="1" placeholder="ex: 30" />
                <div class="unit">%</div>
              </div>
              <div class="hint">Fraction d’oxygène (pourcentage).</div>
            </div>

            <div class="actions" style="grid-column: 1 / -1;">
              <button type="button" class="primary" id="btnCalc">Calculer</button>
              <button type="button" id="btnDemo">Exemple (200 bar)</button>
              <button type="reset" id="btnReset">Réinitialiser</button>
            </div>

            <div class="note" style="grid-column: 1 / -1;">
              <b>Règles:</b> <br/>
              O2 : autonomie = (5×P) / ((Vt/1000)×FR×(FiO2/100)×1,3) ; OK si &gt; 45 min.<br/>
              Air : autonomie = (5×P) / débit fixe (20 ou 10) ; OK si &gt; 45 min ; Oxylog 2000 = RAS.
            </div>
          </form>
        </div>
      </section>

      <!-- RESULTS -->
      <section class="card">
        <div class="hd">
          <h2>Résultats</h2>
          <p>Autonomie théorique et alerte</p>
        </div>
        <div class="bd">
          <div class="results">
            <div class="pill">
              <div>
                <h3>Oxygène</h3>
                <div class="meta" id="o2Meta">—</div>
              </div>
              <div class="status">
                <div class="chip stop" id="o2Chip">STOP</div>
                <div class="value" id="o2Val">—</div>
              </div>
            </div>

            <div class="pill">
              <div>
                <h3>Air</h3>
                <div class="meta" id="airMeta">—</div>
              </div>
              <div class="status">
                <div class="chip ras" id="airChip">RAS</div>
                <div class="value" id="airVal">—</div>
              </div>
            </div>

            <div class="kpi">
              <div class="box">
                <div class="t">Consommation O2 estimée</div>
                <div class="n" id="kpiO2">—</div>
                <div class="t">L/min (avec marge ×1,3)</div>
              </div>
              <div class="box">
                <div class="t">Débit Air retenu</div>
                <div class="n" id="kpiAir">—</div>
                <div class="t">L/min (selon respirateur)</div>
              </div>
            </div>

            <div class="tiny" id="debug">
              Astuce : si tu colles “200 bar”, c’est OK. Les champs vides ou incohérents donnent STOP / RAS.
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>


<footer class="footer">
  Dr Benjamin Dusang — Réanimation pédiatrique
</footer>



<script>
  // === Paramètres ===
  const BOTTLE_L = 5;         // L (volume bouteille)
  const THRESH_MIN = 45;      // minutes
  const O2_SAFETY = 1.3;      // marge O2

  // Débits air fixes L/min
  const AIR_FLOW = {
    "Fabian": 20,
    "BabyPAC": 10,
    "Oxylog 2000": null // hors règle => RAS
  };

  // Helpers
  function parseNumberLikeFR(input){
    // accepte "200", "200 bar", "200,5", "200.5", espaces
    if (input === null || input === undefined) return NaN;
    let s = String(input).trim().toLowerCase();
    s = s.replaceAll("bar", "").replaceAll("\u00A0"," ").trim(); // nbsp
    s = s.replace(/\s+/g, "");
    s = s.replace(",", "."); // virgule -> point
    const n = Number(s);
    return Number.isFinite(n) ? n : NaN;
  }

  function fmt(n, digits=1){
    if (!Number.isFinite(n)) return "—";
    return n.toFixed(digits).replace(".", ",");
  }

  function setChip(el, status){
    el.classList.remove("ok","stop","ras");
    if (status === "OK"){ el.classList.add("ok"); el.textContent="OK"; return; }
    if (status === "STOP"){ el.classList.add("stop"); el.textContent="STOP"; return; }
    el.classList.add("ras"); el.textContent="RAS";
  }

  function calc(){
    const resp = document.getElementById("resp").value;

    const pO2 = parseNumberLikeFR(document.getElementById("pO2").value);
    const pAir = parseNumberLikeFR(document.getElementById("pAir").value);

    const fr = Number(document.getElementById("fr").value);
    const vtMl = Number(document.getElementById("vt").value);
    const fio2pct = Number(document.getElementById("fio2").value);

    // --- OXYGENE ---
    const o2Meta = document.getElementById("o2Meta");
    const o2Chip = document.getElementById("o2Chip");
    const o2Val = document.getElementById("o2Val");
    const kpiO2 = document.getElementById("kpiO2");

    let o2Status = "STOP";
    let o2AutMin = NaN;
    let o2ConsLpm = NaN;

    const vtL = vtMl / 1000;
    const fio2 = fio2pct / 100;

    const o2InputsOK =
      Number.isFinite(pO2) && pO2 > 0 &&
      Number.isFinite(fr) && fr > 0 &&
      Number.isFinite(vtMl) && vtMl > 0 &&
      Number.isFinite(fio2pct) && fio2pct >= 21 && fio2pct <= 100;

    if (o2InputsOK){
      o2ConsLpm = vtL * fr * fio2 * O2_SAFETY;
      const o2AvailL = BOTTLE_L * pO2;
      o2AutMin = o2AvailL / o2ConsLpm;
      o2Status = (o2AutMin > THRESH_MIN) ? "OK" : "STOP";
    }

    setChip(o2Chip, o2Status);
    o2Meta.textContent = `Bouteille ${BOTTLE_L} L × ${fmt(pO2,0)} bar · Vt ${fmt(vtMl,0)} mL · FR ${fmt(fr,0)}/min · FiO2 ${fmt(fio2pct,0)}%`;
    o2Val.textContent = Number.isFinite(o2AutMin) ? `Autonomie ≈ ${fmt(o2AutMin,1)} min` : "—";
    kpiO2.textContent = Number.isFinite(o2ConsLpm) ? fmt(o2ConsLpm,2) : "—";

    // --- AIR ---
    const airMeta = document.getElementById("airMeta");
    const airChip = document.getElementById("airChip");
    const airVal = document.getElementById("airVal");
    const kpiAir = document.getElementById("kpiAir");

    const flow = AIR_FLOW[resp]; // L/min
    let airStatus = "RAS";
    let airAutMin = NaN;

    if (resp === "Oxylog 2000"){
      airStatus = "RAS";
    } else {
      const airInputsOK = Number.isFinite(pAir) && pAir > 0 && Number.isFinite(flow) && flow > 0;
      if (airInputsOK){
        const airAvailL = BOTTLE_L * pAir;
        airAutMin = airAvailL / flow;
        airStatus = (airAutMin > THRESH_MIN) ? "OK" : "STOP";
      } else {
        airStatus = "STOP";
      }
    }

    setChip(airChip, airStatus);
    airMeta.textContent = (resp === "Oxylog 2000")
      ? `Respirateur: ${resp} · Règle Air non appliquée (RAS)`
      : `Respirateur: ${resp} · Débit fixe ${flow} L/min · Bouteille ${BOTTLE_L} L × ${fmt(pAir,0)} bar`;

    airVal.textContent = (resp === "Oxylog 2000")
      ? "—"
      : (Number.isFinite(airAutMin) ? `Autonomie ≈ ${fmt(airAutMin,1)} min` : "—");

kpiAir.textContent = (resp === "Oxylog 2000") ? "Sans objet" : (Number.isFinite(flow) ? `${fmt(flow,0)} L/min` : "—");
  }

  // Buttons
  document.getElementById("btnCalc").addEventListener("click", calc);
  document.getElementById("btnDemo").addEventListener("click", () => {
    document.getElementById("resp").value = "Fabian";
    document.getElementById("pO2").value = "200";
    document.getElementById("pAir").value = "200";
    document.getElementById("fr").value = "30";
    document.getElementById("vt").value = "120";
    document.getElementById("fio2").value = "30";
    calc();
  });
  document.getElementById("btnReset").addEventListener("click", () => {
    setTimeout(calc, 0);
  });

  // Auto-calc on input change
  ["resp","pO2","pAir","fr","vt","fio2"].forEach(id => {
    document.getElementById(id).addEventListener("input", () => {
      // avoid too chatty; still instant feedback
      calc();
    });
  });

  // First paint
  calc();
</script>
</body>
</html>